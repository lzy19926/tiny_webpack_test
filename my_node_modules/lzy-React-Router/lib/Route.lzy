import * as LzyReact from '../../lzy-React/out/index_V3'
import { renderRoute, myUseEffect } from '../../lzy-React/out/index_V3'


//todo history模式路由页面简易逻辑
function switchRouteHistory(path, id) {
    if (location.pathname === path) return

    // 修改页面path
    history.pushState(null, '', path)
    const element = window.$$routerMap[id].components[path]
    const containerDomFiber = window.$$routerMap[id].containerFiber._child
    renderRoute(element, containerDomFiber)

}

// 定义注册路由
export function Route(props, children, fiber) {
    const { path, component } = props

    // 使用useEffect执行默认路由
    if (path === '/') {
        myUseEffect(() => {
            renderRoute(component, fiber._parent)
        })
    }

    return <span></span>
}

// 路由占位组件  是一个div容器
export function RouteContainer({ id }, children, fiber) {

    // 创建并挂载容器到全局
    if (!window.$$routerMap) {
        window.$$routerMap = {}
    }

    window.$$routerMap[id] = {
        containerFiber: fiber,
        components: {}
    }

    // 注册Route
    children.forEach((child) => {
        if (child.tag === 'Route') {
            const { path, component } = child.props
            window.$$routerMap[id].components[path] = component
        }
    })


    return <div>{children}</div>
}

// Link组件
export function Link(props, children, fiber) {

    const { to, title, id } = props
    const linkTo = () => { switchRouteHistory(to, id) }

    return (<a href='javascript:;' onClick={linkTo} >{title} </a>)
}
