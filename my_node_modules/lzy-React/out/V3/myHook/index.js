"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.myUseImperativeHandle = exports.createContext = exports.myUseRef = exports.myUseContext = exports.myUseEffect = exports.myUseState = exports.switchHooksDispatcher = exports.resolveDispatcher = void 0;
const useState_1 = require("./useState");
const useEffect_1 = require("./useEffect");
const useRef_1 = require("./useRef");
Object.defineProperty(exports, "myUseRef", { enumerable: true, get: function () { return useRef_1.myUseRef; } });
const useContext_1 = require("./useContext");
Object.defineProperty(exports, "createContext", { enumerable: true, get: function () { return useContext_1.createContext; } });
const useImperativeHandle_1 = require("./useImperativeHandle");
Object.defineProperty(exports, "myUseImperativeHandle", { enumerable: true, get: function () { return useImperativeHandle_1.myUseImperativeHandle; } });
// 全局的hookDispatcher, 会根据hook的状态切换是mount还是update的Hook
const ReactCurrentDispatcher = {
    current: null,
};
// hook分为两种,mount和update, 在执行时会根据函数组件fiber类型获取不同的hookDispatcher,执行不同的hook
const HooksDispatcherOnMount = {
    useState: useState_1.mountState,
    useEffect: useEffect_1.mountEffect,
    useContext: useContext_1.mountContext
};
const HooksDispatcherOnUpdate = {
    useState: useState_1.updateState,
    useEffect: useEffect_1.updateEffect,
    // 同mount逻辑相同的hooks
    useContext: useContext_1.mountContext
};
// 获取当前的dispatcher
function resolveDispatcher() {
    const dispatcher = ReactCurrentDispatcher.current;
    if (dispatcher === null) {
        console.error("Invalid hook call. Hook只能在函数组件中使用, 未正确挂载hookDsipatcher");
    }
    return dispatcher;
}
exports.resolveDispatcher = resolveDispatcher;
// 根据fiber状态切换钩子类型
function switchHooksDispatcher(fiberFlag) {
    ReactCurrentDispatcher.current =
        fiberFlag === "mount"
            ? HooksDispatcherOnMount
            : HooksDispatcherOnUpdate;
}
exports.switchHooksDispatcher = switchHooksDispatcher;
/*******************************************************************************************
* Hooks
******************************************************************************************/
function myUseState(initialState) {
    const dispatcher = resolveDispatcher();
    return dispatcher.useState(initialState);
}
exports.myUseState = myUseState;
function myUseEffect(create, deps) {
    const dispatcher = resolveDispatcher();
    return dispatcher.useEffect(create, deps);
}
exports.myUseEffect = myUseEffect;
function myUseContext(context) {
    const dispatcher = resolveDispatcher();
    return dispatcher.useContext(context);
}
exports.myUseContext = myUseContext;
